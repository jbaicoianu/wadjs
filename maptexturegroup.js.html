<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: maptexturegroup.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: maptexturegroup.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Class representing the geometry associated with a given texture
 */
export class MapTextureGroup {
  constructor(texture) {
    this.vertices = [];
    this.faces = [];
    this.uvs = [];
    this.colors = [];
    this.texture = texture;
  }
  /**
   * Generate a textured quad to add to this group
   * @param {WadJS.Vector} v1 - 
   * @param {WadJS.Vector} v2 - 
   * @param {integer} floorheight - 
   * @param {integer} ceilingheight - 
   * @param {WadJS.Linedef} linedef - 
   * @param {WadJS.Sidedef} side - 
   * @param {WadJS.Sector} sector1 - 
   * @param {WadJS.Sector} sector2 - 
   * @param {boolean} isLower - 
   * @param {boolean} isUpper - 
   */
  addQuad(v1, v2, floorheight, ceilingheight, linedef, side, sector1, sector2, isLower, isUpper) {
    var vertexOffset = this.vertices.length / 3;

    this.vertices.push(v1.x, v1.y, floorheight);   // bottom left
    this.vertices.push(v1.x, v1.y, ceilingheight); // top left
    this.vertices.push(v2.x, v2.y, ceilingheight); // top right
    this.vertices.push(v2.x, v2.y, floorheight);   // bottom right

    var quadtype = (isUpper ? 'top' : (isLower ? 'bottom' : 'middle')) 
    var uvs = side.getUVs(quadtype, floorheight, ceilingheight, this.texture);
    this.uvs.push.apply(this.uvs, uvs);

    this.faces.push(vertexOffset, vertexOffset + 2, vertexOffset + 1);
    this.faces.push(vertexOffset, vertexOffset + 3, vertexOffset + 2);

    side.addQuad(quadtype, [vertexOffset, vertexOffset + 1, vertexOffset + 2, vertexOffset + 3]);

    // Use vertex colors to simulate sector lighting

    for (var i = 0; i &lt; 4; i++) {
      this.colors.push(sector1.lightlevel / 255, sector1.lightlevel / 255, sector1.lightlevel / 255);
    }
  }
  /**
   * Add an arbitrarily-sized polygon to this group
   * @param {array} vertices - 
   * @param {array} faces - 
   * @param {WadJS.Sector} sector - 
   */
  add(vertices, faces, sector) {
    var lightlevel = sector.lightlevel / 255;
    var vertexoffset = this.vertices.length / 3;
    for (var i = 0; i &lt; vertices.length; i++) {
      this.vertices.push(vertices[i]);
      this.colors.push(lightlevel);
    }
    for (var i = 0; i &lt; vertices.length / 3; i++) {
      var x = vertices[i * 3] / 64,
          y = vertices[i * 3 + 1] / 64;
      this.uvs.push(x, y);
    }
    var newfaces = [];
    for (var i = 0; i &lt; faces.length; i++) {
      this.faces.push(faces[i][0] + vertexoffset, faces[i][1] + vertexoffset, faces[i][2] + vertexoffset);
      newfaces.push(faces[i][0] + vertexoffset, faces[i][1] + vertexoffset, faces[i][2] + vertexoffset);
    }
    return newfaces;
  }
  /**
   * Get the buffer data needed to render this group
   * @returns {object}
   */
  getBuffers() {
    return {
      index: new Int32Array(this.faces),
      position: new Float32Array(this.vertices),
      uv: new Float32Array(this.uvs),
      color: new Float32Array(this.colors),
    }
  }
}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BoundingBox.html">BoundingBox</a></li><li><a href="Flat.html">Flat</a></li><li><a href="Linedef.html">Linedef</a></li><li><a href="Lump.html">Lump</a></li><li><a href="Map.html">Map</a></li><li><a href="MapTextureGroup.html">MapTextureGroup</a></li><li><a href="Node.html">Node</a></li><li><a href="Palette.html">Palette</a></li><li><a href="Patch.html">Patch</a></li><li><a href="PatchImage.html">PatchImage</a></li><li><a href="PatchImageColumn.html">PatchImageColumn</a></li><li><a href="PatchList.html">PatchList</a></li><li><a href="Sector.html">Sector</a></li><li><a href="Segment.html">Segment</a></li><li><a href="Sidedef.html">Sidedef</a></li><li><a href="Sprite.html">Sprite</a></li><li><a href="Subsector.html">Subsector</a></li><li><a href="Texture.html">Texture</a></li><li><a href="TextureList.html">TextureList</a></li><li><a href="Thing.html">Thing</a></li><li><a href="Vertex.html">Vertex</a></li><li><a href="WadFile.html">WadFile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Sep 23 2017 17:27:01 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
